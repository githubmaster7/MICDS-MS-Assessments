<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MICDS Assessment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<!-- LOGIN -->
<div id="login-screen" class="sheet-wrap">
  <div class="sheet-card">
    <div class="sheet-title">MICDS Assessment</div>
    <div class="sheet-subtitle">Sign in with your MICDS Google account (@micds.org)</div>
    <button id="login-btn" class="btn primary">Sign in with Google</button>
    <div id="login-error" class="error hidden"></div>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <div class="topbar">
    <div class="topbar-left">
      <div class="brand">MICDS Assessment</div>
      <div id="user-pill" class="pill"></div>
      <div id="role-pill" class="pill"></div>
    </div>

    <div class="topbar-right">
      <button id="export-btn" class="btn">Export JSON</button>
      <label class="btn ghost filebtn">
        Import JSON
        <input id="import-file" type="file" accept="application/json" />
      </label>
      <button id="logout-btn" class="btn danger">Log out</button>
    </div>
  </div>

  <div class="layout">
    <aside class="sidebar sheet-card">
      <div class="sidebar-title">Navigation</div>
      <button class="navbtn active" data-view="overview">Overview</button>

      <!-- Dynamically filled from data.js -->
      <div id="nav-sections"></div>

      <div class="divider"></div>

      <div id="teacher-panel" class="hidden">
        <div class="sidebar-title">Teacher</div>
        <label class="label">Select student</label>
        <select id="teacher-student-select"></select>
        <button id="teacher-new-student" class="btn small">Add student by email</button>
        <div class="muted small" style="margin-top:8px;">
          Teachers can view/edit any student record.
        </div>
      </div>

      <div class="divider"></div>
      <div class="muted small">
        Spreadsheet-style rubric view. Data stored in Firestore.
      </div>
    </aside>

    <main class="content">
      <section class="sheet-card view" id="view-overview">
        <div class="sheet-h2">Overview</div>

        <div class="grid2">
          <div class="sheet-card inner">
            <div class="sheet-h3">Final Grade</div>
            <div class="kpi">
              <div class="kpi-big" id="final-grade">—</div>
              <div class="muted small">Average of Standards 1–4 (25% each)</div>
            </div>
            <div class="kpi-row">
              <div class="kpi-mini"><div class="muted small">Std 1</div><div class="kpi-mid" id="s1-grade">—</div></div>
              <div class="kpi-mini"><div class="muted small">Std 2</div><div class="kpi-mid" id="s2-grade">—</div></div>
              <div class="kpi-mini"><div class="muted small">Std 3</div><div class="kpi-mid" id="s3-grade">—</div></div>
              <div class="kpi-mini"><div class="muted small">Std 4</div><div class="kpi-mid" id="s4-grade">—</div></div>
            </div>
          </div>

          <div class="sheet-card inner">
            <div class="sheet-h3">Honor Code (Student)</div>
            <label class="checkbox">
              <input type="checkbox" id="honor-code" />
              I affirm I used only my own knowledge to answer these questions.
            </label>
            <div class="muted small" style="margin-top:8px;">
              Teachers can grade regardless, but students should check before submitting.
            </div>
          </div>
        </div>

        <div class="sheet-card inner" style="margin-top:12px;">
          <div class="sheet-h3">Quick instructions</div>
          <ul class="small">
            <li><b>Students:</b> fill answers + self ratings. Reassessment unlocks only if teacher score is 1–2.</li>
            <li><b>Teachers:</b> select a student, enter teacher scores/ratings.</li>
            <li>This page is intentionally formatted like a spreadsheet (grid, compact cells).</li>
          </ul>
        </div>
      </section>

      <!-- Dynamic views injected by app.js -->
      <div id="dynamic-views"></div>
    </main>
  </div>
</div>

<!-- Firebase SDKs (COMPAT) - LOAD ONCE, AT BOTTOM -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script src="firebase-config.js"></script>
<script src="data.js"></script>
<script src="db.js"></script>
<script src="app.js"></script>
<script src="auth.js"></script>

</body>
</html>
